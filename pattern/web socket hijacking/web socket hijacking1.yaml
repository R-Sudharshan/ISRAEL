version: "1.0"
rule_set: "websocket_abuse_detection"

rule:
  id: WS-001
  name: WebSocket Connection without Origin Validation
  severity: high
  confidence: high
  description: >
    Detects WebSocket handshake requests that do not enforce Origin
    validation, potentially allowing cross-site WebSocket hijacking.
  conditions:
    all:
      - request.protocol == "websocket"
      - request.headers.origin exists
      - request.headers.origin not in allowed_origin_whitelist
      - response.status_code == 101
  evidence_fields:
    - request.headers.origin
    - request.endpoint
    - response.status_code
  risk_reason: >
    Missing Origin validation allows untrusted websites to establish
    authenticated WebSocket connections.
  references:
    - OWASP WebSocket Security Cheat Sheet
    - CWE-346
